<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UpLinkAI – Feedback</title>
  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 + ReactDOM (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    * { scroll-behavior: smooth; }
    .glass { backdrop-filter: blur(10px); background: rgba(255,255,255,0.7); }
    .dark .glass { background: rgba(17,24,39,0.6); }
    .star { cursor: pointer; transition: transform .1s ease; }
    .star:hover { transform: scale(1.1); }
  </style>
</head>
<body class="bg-gradient-to-br from-sky-50 to-indigo-50 dark:from-slate-900 dark:to-slate-950 text-slate-800 dark:text-slate-100 min-h-screen">
  <div id="root"></div>
  
  <script>
    // ======= CONFIG =======
    const APP_NAME = 'UpLinkAI Feedback';
    const STORAGE_KEY = 'uplinkai_feedback_v1';
    const ADMIN_PIN = '2468'; // change this
    const WEBHOOK_URL = ''; // optional: set to your endpoint to receive JSON

    // ======= UTILS =======
    const nowIST = () => {
      // Format timestamp in Asia/Kolkata (IST)
      const fmt = new Intl.DateTimeFormat('en-IN', { dateStyle: 'medium', timeStyle: 'short', timeZone: 'Asia/Kolkata' });
      return fmt.format(new Date());
    };

    const uid = () => Math.random().toString(36).slice(2) + Date.now().toString(36);

    const saveToStorage = (items) => localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    const loadFromStorage = () => {
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; } catch { return []; }
    };

    const exportCSV = (rows) => {
      const headers = ['id','timestampIST','name','email','role','category','rating','message','consentPublic'];
      const esc = (v) => '"' + String(v ?? '').replaceAll('"', '""') + '"';
      const lines = [headers.join(',')].concat(rows.map(r => headers.map(h => esc(r[h])).join(',')));
      const blob = new Blob([lines.join('\n')], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'feedback_export_' + Date.now() + '.csv';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    };

    const postWebhook = async (payload) => {
      if (!WEBHOOK_URL) return { ok: false, skipped: true };
      try {
        const res = await fetch(WEBHOOK_URL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
        return { ok: res.ok };
      } catch (e) { return { ok: false, error: e.message }; }
    };

    // ======= APP =======
    const { useState, useEffect, useMemo } = React;

    function StarRating({ value, onChange }) {
      return React.createElement('div', { className: 'flex items-center gap-1' },
        [1,2,3,4,5].map(i => React.createElement('button', {
          key: i,
          type: 'button',
          className: 'star',
          onClick: () => onChange(i),
          'aria-label': i + ' star'
        },
          React.createElement('svg', {
            xmlns: 'http://www.w3.org/2000/svg',
            viewBox: '0 0 24 24',
            fill: i <= value ? 'currentColor' : 'none',
            stroke: 'currentColor',
            className: 'w-6 h-6 ' + (i <= value ? 'text-yellow-500' : 'text-slate-400')
          }, React.createElement('path', { strokeLinecap: 'round', strokeLinejoin: 'round', strokeWidth: 1.5, d: 'M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.2 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.956 20.54a.562.562 0 01-.84-.61l1.285-5.385a.563.563 0 00-.182-.557l-4.2-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z' }))
        ))
      );
    }

    function Toast({ show, message, onClose }) {
      useEffect(() => {
        if (!show) return; const t = setTimeout(onClose, 2200); return () => clearTimeout(t);
      }, [show]);
      return show ? (
        React.createElement('div', { className: 'fixed top-4 right-4 z-50' },
          React.createElement('div', { className: 'px-4 py-2 rounded-2xl shadow-lg bg-emerald-600 text-white' }, message)
        )
      ) : null;
    }

    function Header({ onToggleTheme, dark }) {
      return (
        React.createElement('header', { className: 'sticky top-0 z-30 border-b border-slate-200/50 dark:border-slate-800/60 bg-white/60 dark:bg-slate-900/60 backdrop-blur' },
          React.createElement('div', { className: 'max-w-5xl mx-auto px-4 py-3 flex items-center justify-between' }, [
            React.createElement('div', { key: 'title', className: 'flex items-center gap-2' }, [
              React.createElement('div', { className: 'w-8 h-8 rounded-2xl bg-sky-500' }),
              React.createElement('h1', { className: 'font-semibold text-lg' }, APP_NAME)
            ]),
            React.createElement('div', { key: 'actions', className: 'flex items-center gap-2' }, [
              React.createElement('a', { href: '#wall', className: 'text-sm px-3 py-1 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800' }, 'Wall'),
              React.createElement('a', { href: '#admin', className: 'text-sm px-3 py-1 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800' }, 'Admin'),
              React.createElement('button', { onClick: onToggleTheme, className: 'text-sm px-3 py-1 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800' }, dark ? 'Light' : 'Dark')
            ])
          ])
        )
      );
    }

    function FeedbackForm({ onSubmit }) {
      const [name, setName] = useState('');
      const [email, setEmail] = useState('');
      const [role, setRole] = useState('Student');
      const [category, setCategory] = useState('General');
      const [rating, setRating] = useState(5);
      const [message, setMessage] = useState('');
      const [consent, setConsent] = useState(true);
      const [submitting, setSubmitting] = useState(false);

      const valid = message.trim().length >= 10;

      const handleSubmit = async (e) => {
        e.preventDefault();
        if (!valid || submitting) return;
        setSubmitting(true);
        const item = {
          id: uid(), timestampIST: nowIST(), name: name.trim(), email: email.trim(), role, category, rating, message: message.trim(), consentPublic: !!consent
        };
        const { ok } = await postWebhook(item);
        onSubmit(item, ok);
        setSubmitting(false);
        // reset simple fields, keep name/email for faster repeat
        setMessage(''); setRating(5); setCategory('General');
      };

      return (
        React.createElement('form', { onSubmit: handleSubmit, className: 'space-y-4' }, [
          React.createElement('div', { key: 'grid', className: 'grid grid-cols-1 sm:grid-cols-2 gap-4' }, [
            React.createElement('div', { key: 'name' }, [
              React.createElement('label', { className: 'text-sm font-medium' }, 'Name (optional)'),
              React.createElement('input', { value: name, onChange: e => setName(e.target.value), className: 'mt-1 w-full rounded-2xl border px-3 py-2 bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-400', placeholder: 'Your name' })
            ]),
            React.createElement('div', { key: 'email' }, [
              React.createElement('label', { className: 'text-sm font-medium' }, 'Email (optional)'),
              React.createElement('input', { value: email, onChange: e => setEmail(e.target.value), type: 'email', className: 'mt-1 w-full rounded-2xl border px-3 py-2 bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-400', placeholder: 'you@example.com' })
            ])
          ]),
          React.createElement('div', { key: 'role-cat', className: 'grid grid-cols-1 sm:grid-cols-2 gap-4' }, [
            React.createElement('div', { key: 'role' }, [
              React.createElement('label', { className: 'text-sm font-medium' }, 'I am a'),
              React.createElement('select', { value: role, onChange: e => setRole(e.target.value), className: 'mt-1 w-full rounded-2xl border px-3 py-2 bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-400' },
                ['Student','Founder','Professional','Educator','Other'].map(o => React.createElement('option', { key: o, value: o }, o))
              )
            ]),
            React.createElement('div', { key: 'category' }, [
              React.createElement('label', { className: 'text-sm font-medium' }, 'Category'),
              React.createElement('select', { value: category, onChange: e => setCategory(e.target.value), className: 'mt-1 w-full rounded-2xl border px-3 py-2 bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-400' },
                ['General','UI/UX','Feature Request','Bug','Performance','Content','Other'].map(o => React.createElement('option', { key: o, value: o }, o))
              )
            ])
          ]),
          React.createElement('div', { key: 'rating' }, [
            React.createElement('label', { className: 'text-sm font-medium block' }, 'Rating'),
            React.createElement(StarRating, { value: rating, onChange: setRating })
          ]),
          React.createElement('div', { key: 'msg' }, [
            React.createElement('label', { className: 'text-sm font-medium' }, 'Your feedback'),
            React.createElement('textarea', { value: message, onChange: e => setMessage(e.target.value), rows: 5, className: 'mt-1 w-full rounded-2xl border px-3 py-2 bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-800 focus:outline-none focus:ring-2 focus:ring-sky-400', placeholder: 'Be as specific as possible (min 10 characters)…' })
          ]),
          React.createElement('div', { key: 'consent', className: 'flex items-start gap-2' }, [
            React.createElement('input', { id: 'consent', type: 'checkbox', checked: consent, onChange: e => setConsent(e.target.checked), className: 'mt-1' }),
            React.createElement('label', { htmlFor: 'consent', className: 'text-sm' }, 'I agree to show this feedback on the public wall (name/email hidden).')
          ]),
          React.createElement('div', { key: 'submit', className: 'flex items-center gap-3' }, [
            React.createElement('button', { disabled: !valid || submitting, className: 'px-4 py-2 rounded-2xl bg-sky-500 text-white disabled:opacity-50 hover:bg-sky-600 transition' }, submitting ? 'Submitting…' : 'Submit'),
            React.createElement('span', { className: 'text-xs text-slate-500' }, 'By submitting, you consent to our storage of this feedback for improvement purposes.')
          ])
        ])
      );
    }

    function FeedbackCard({ item }) {
      return (
        React.createElement('div', { className: 'p-4 rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/60 dark:bg-slate-900/60' }, [
          React.createElement('div', { key: 'top', className: 'flex items-center justify-between' }, [
            React.createElement('div', { key: 'meta', className: 'text-xs text-slate-500' }, item.timestampIST + ' • ' + item.category),
            React.createElement('div', { key: 'stars', className: 'text-yellow-500' }, '★'.repeat(item.rating) + '☆'.repeat(5-item.rating))
          ]),
          React.createElement('p', { key: 'msg', className: 'mt-2 text-sm' }, item.message)
        ])
      );
    }

    function AdminPanel({ items, setItems }) {
      const [pin, setPin] = useState('');
      const [ok, setOk] = useState(false);
      const [q, setQ] = useState('');
      const filtered = useMemo(() => items.filter(i => (i.name + i.email + i.role + i.category + i.message).toLowerCase().includes(q.toLowerCase())), [items, q]);

      const deleteOne = (id) => { const next = items.filter(i => i.id !== id); setItems(next); saveToStorage(next); };
      const clearAll = () => { if (!confirm('Delete ALL feedback?')) return; setItems([]); saveToStorage([]); };

      if (!ok) {
        return (
          React.createElement('div', { className: 'p-4 rounded-2xl border border-slate-200 dark:border-slate-800 glass' }, [
            React.createElement('h3', { key: 'h', className: 'font-semibold' }, 'Admin Access'),
            React.createElement('p', { key: 'p', className: 'text-sm text-slate-500 mt-1' }, 'Enter the admin PIN to manage feedback.'),
            React.createElement('div', { key: 'f', className: 'mt-3 flex gap-2' }, [
              React.createElement('input', { value: pin, onChange: e => setPin(e.target.value), placeholder: 'PIN', className: 'rounded-2xl border px-3 py-2 bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-800' }),
              React.createElement('button', { onClick: () => setOk(pin === ADMIN_PIN), className: 'px-4 py-2 rounded-2xl bg-slate-800 text-white dark:bg-white dark:text-slate-900' }, 'Enter')
            ])
          ])
        );
      }

      return (
        React.createElement('div', { className: 'space-y-3' }, [
          React.createElement('div', { key: 'toolbar', className: 'flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-between' }, [
            React.createElement('div', { key: 'left', className: 'flex gap-2 items-center' }, [
              React.createElement('input', { value: q, onChange: e => setQ(e.target.value), placeholder: 'Search…', className: 'rounded-2xl border px-3 py-2 bg-white/70 dark:bg-slate-900/70 border-slate-200 dark:border-slate-800' }),
              React.createElement('button', { onClick: () => exportCSV(items), className: 'px-3 py-2 rounded-2xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800' }, 'Export CSV')
            ]),
            React.createElement('div', { key: 'right', className: 'flex gap-2 items-center' }, [
              React.createElement('button', { onClick: clearAll, className: 'px-3 py-2 rounded-2xl bg-rose-600 text-white' }, 'Clear All')
            ])
          ]),
          React.createElement('div', { key: 'table', className: 'overflow-x-auto' },
            React.createElement('table', { className: 'min-w-full text-sm' }, [
              React.createElement('thead', { key: 'th', className: 'text-left text-slate-500' },
                React.createElement('tr', null, ['Time (IST)','Name','Email','Role','Category','Rating','Message','Public','Actions'].map(h => React.createElement('th', { key: h, className: 'px-3 py-2' }, h)))
              ),
              React.createElement('tbody', { key: 'tb' },
                filtered.map(row => React.createElement('tr', { key: row.id, className: 'border-t border-slate-200 dark:border-slate-800 align-top' }, [
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' }, row.timestampIST),
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' }, row.name || '—'),
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' }, row.email || '—'),
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' }, row.role),
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' }, row.category),
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' }, row.rating),
                  React.createElement('td', { className: 'px-3 py-2 max-w-[28rem]' }, row.message),
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' }, row.consentPublic ? 'Yes' : 'No'),
                  React.createElement('td', { className: 'px-3 py-2 whitespace-nowrap' },
                    React.createElement('button', { onClick: () => deleteOne(row.id), className: 'px-2 py-1 rounded-xl border border-slate-300 dark:border-slate-700 hover:bg-slate-100 dark:hover:bg-slate-800' }, 'Delete')
                  )
                ]))
              )
            ])
          )
        ])
      );
    }

    function App() {
      const [dark, setDark] = useState(false);
      const [items, setItems] = useState(loadFromStorage());
      const [toast, setToast] = useState({ show: false, msg: '' });

      useEffect(() => { document.documentElement.classList.toggle('dark', dark); }, [dark]);

      const latestPublic = useMemo(() => items.filter(i => i.consentPublic).slice(-12).reverse(), [items]);

      const handleSubmit = (item, webhookOk) => {
        const next = [...items, item];
        setItems(next); saveToStorage(next);
        setToast({ show: true, msg: webhookOk ? 'Thanks! Submitted + Sent.' : 'Thanks! Feedback submitted.' });
      };

      return (
        React.createElement('main', { className: 'pb-16' }, [
          React.createElement(Header, { key: 'header', dark, onToggleTheme: () => setDark(v => !v) }),

          React.createElement('section', { key: 'hero', className: 'max-w-5xl mx-auto px-4 pt-10' }, [
            React.createElement('div', { key: 'card', className: 'p-6 rounded-3xl glass border border-slate-200 dark:border-slate-800' }, [
              React.createElement('h2', { className: 'text-2xl font-bold' }, 'We\'re building for you. Your feedback matters.'),
              React.createElement('p', { className: 'text-slate-600 dark:text-slate-300 mt-1' }, 'Tell us what works, what\'s missing, or what\'s confusing. We read every message.'),
              React.createElement('div', { className: 'mt-6' }, React.createElement(FeedbackForm, { onSubmit: handleSubmit }))
            ])
          ]),

          React.createElement('section', { key: 'wall', id: 'wall', className: 'max-w-5xl mx-auto px-4 mt-10' }, [
            React.createElement('div', { className: 'flex items-center justify-between' }, [
              React.createElement('h3', { className: 'text-xl font-semibold' }, 'Public Feedback Wall'),
              React.createElement('span', { className: 'text-sm text-slate-500' }, latestPublic.length + ' shown')
            ]),
            latestPublic.length ? (
              React.createElement('div', { className: 'mt-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4' },
                latestPublic.map(f => React.createElement(FeedbackCard, { key: f.id, item: f }))
              )
            ) : (
              React.createElement('p', { className: 'text-sm text-slate-500 mt-3' }, 'No public feedback yet. Be the first!')
            )
          ]),

          React.createElement('section', { key: 'admin', id: 'admin', className: 'max-w-5xl mx-auto px-4 mt-12' }, [
            React.createElement('h3', { className: 'text-xl font-semibold mb-3' }, 'Admin'),
            React.createElement(AdminPanel, { items, setItems })
          ]),

          React.createElement(Toast, { key: 'toast', show: toast.show, message: toast.msg, onClose: () => setToast({ show: false, msg: '' }) })
        ])
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));

    // Init lucide icons if needed
    window.addEventListener('DOMContentLoaded', () => { if (window.lucide) window.lucide.createIcons(); });
  </script>
</body>
</html>
